<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>ZC102MM0001F01</title>
</head>
<body bgcolor="#FFFFE0">
<font size="3" face = "Arial" color="#000000"><b>Code listing for: ZC102MM0001F01</b></font>
<br>
<font size="3" face = "Arial" color="#000000"><b>Description:  Include ZC102MM0001F01</b></font>
<hr>
<pre width="100">
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Include          ZC102MM0001F01</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_data .

<font color ="#0000FF">*-- 초기화</font>
  CLEAR: gt_pr, gt_tab2, gt_tab3, gt_tab4, gt_po.
  REFRESH: gt_pr, gt_tab2, gt_tab3, gt_tab4, gt_po.

<font color ="#0000FF">*-- 구매요청 전체 조회 및 상태별 분기 처리</font>
  SELECT DISTINCT prno matnr pequan meins stprs waers partner state stlno
         depno ddtext AS depno_name
    INTO CORRESPONDING FIELDS OF TABLE gt_pr
    FROM zc102mmt0017 AS a
    INNER JOIN dd07t AS b
    ON a~depno = b~domvalue_l
    WHERE prno IN gr_prno
      AND b~domname = 'ZC102D_MM_DEPNO'
    ORDER BY prno DESCENDING.

  IF sy-dbcnt IS INITIAL.

    MESSAGE s004 DISPLAY LIKE 'E'.
    RETURN.

  ELSE.
    LOOP AT gt_pr INTO DATA(ls_pr).

<font color ="#0000FF">*-- 상태 아이콘 설정</font>
      CASE ls_pr-state.
        WHEN '1'.
          ls_pr-status = icon_led_green.
          gs_tab4 = CORRESPONDING #( ls_pr ).
          APPEND gs_tab4 TO gt_tab4. " 승인 탭
        WHEN '2'.
          ls_pr-status = icon_led_red.
          gs_tab3 = CORRESPONDING #( ls_pr ).
          APPEND gs_tab3 TO gt_tab3. " 반려 탭
        WHEN '3'.
          ls_pr-status = icon_led_yellow.
          gs_tab2 = CORRESPONDING #( ls_pr ).
          APPEND gs_tab2 TO gt_tab2. " 대기 탭
      ENDCASE.

      MODIFY gt_pr FROM ls_pr.

    ENDLOOP.

    PERFORM count_data.
    MESSAGE s000 WITH |총 { sy-dbcnt }건이 조회되었습니다. (대기: { gv_apprv_cnt }, 승인: { gv_rdy_cnt }, 반려: { gv_rtrn_cnt })|.

  ENDIF.

<font color ="#0000FF">*-- 구매오더 내역 조회 (별도 테이블)</font>
  CLEAR gt_po.
  SELECT ebeln podat partner matnr stprs waers menge meins dzeit gredat prno stlno
    INTO CORRESPONDING FIELDS OF TABLE gt_po
    FROM zc102mmt0011
    WHERE prno IN gr_prno.

ENDFORM.

<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_screen .

  IF go_tab_cont1 IS NOT BOUND.

<font color ="#0000FF">*-- TOP : 구매요청 내역</font>
    CLEAR : gt_tab_fcat1, gs_tab_fcat1,
            gt_tab_fcat2, gs_tab_fcat2,
            gt_tab_fcat3, gs_tab_fcat3.

    PERFORM set_fcat1 USING : 'X' 'STATUS'  'ICON'         'C' ' ',  " 승인여부 표시 아이콘
                              'X' 'PRNO'    'ZC102MMT0017' ' ' ' ',  " 구매요청 번호
                              'X' 'MATNR'   'ZC102MMT0017' 'C' ' ',  " 자재 번호
                              ' ' 'STLNO'   'ZC102MMT0017' ' ' ' ',  " 창고 번호
                              ' ' 'PEQUAN'  'ZC102MMT0017' ' ' ' ',  " 수량
                              ' ' 'MEINS'   'ZC102MMT0017' 'C' 'X',  " 단위
                              ' ' 'STPRS'   'ZC102MMT0017' ' ' ' ',  " 단가
                              ' ' 'WAERS'   'ZC102MMT0017' 'C' 'X',  " 통화키
                              ' ' 'PARTNER' 'ZC102MMT0017' 'C' ' ',  " 비즈니스파트너 번호
                              ' ' 'DEPNO_NAME'   ' '       'C' ' '.  " 구매요청부서 번호

    PERFORM set_fcat2 USING : 'X' 'STATUS'  'ICON'         'C' ' ',  " 승인여부 표시 아이콘
                              'X' 'PRNO'    'ZC102MMT0017' ' ' ' ',  " 구매요청 번호
                              'X' 'MATNR'   'ZC102MMT0017' 'C' ' ',  " 자재 번호
                              ' ' 'STLNO'   'ZC102MMT0017' ' ' ' ',  " 창고 번호
                              ' ' 'PEQUAN'  'ZC102MMT0017' ' ' ' ',  " 수량
                              ' ' 'MEINS'   'ZC102MMT0017' 'C' 'X',  " 단위
                              ' ' 'STPRS'   'ZC102MMT0017' ' ' ' ',  " 단가
                              ' ' 'WAERS'   'ZC102MMT0017' 'C' 'X',  " 통화키
                              ' ' 'PARTNER' 'ZC102MMT0017' 'C' ' ',  " 비즈니스파트너 번호
                              ' ' 'DEPNO_NAME'   ' '       'C' ' '.  " 구매요청부서 번호

    PERFORM set_fcat3 USING : 'X' 'STATUS'  'ICON'         'C' ' ',  " 승인여부 표시 아이콘
                              'X' 'PRNO'    'ZC102MMT0017' ' ' ' ',  " 구매요청 번호
                              'X' 'MATNR'   'ZC102MMT0017' 'C' ' ',  " 자재 번호
                              ' ' 'STLNO'   'ZC102MMT0017' ' ' ' ',  " 창고 번호
                              ' ' 'PEQUAN'  'ZC102MMT0017' ' ' ' ',  " 수량
                              ' ' 'MEINS'   'ZC102MMT0017' 'C' 'X',  " 단위
                              ' ' 'STPRS'   'ZC102MMT0017' ' ' ' ',  " 단가
                              ' ' 'WAERS'   'ZC102MMT0017' 'C' 'X',  " 통화키
                              ' ' 'PARTNER' 'ZC102MMT0017' 'C' ' ',  " 비즈니스파트너 번호
                              ' ' 'DEPNO_NAME'   ' '       'C' ' '.  " 구매요청부서 번호

    PERFORM set_fcat4 USING : 'X' 'STATUS'  'ICON'         'C' ' ',  " 승인여부 표시 아이콘
                              'X' 'PRNO'    'ZC102MMT0017' ' ' ' ',  " 구매요청 번호
                              'X' 'MATNR'   'ZC102MMT0017' 'C' ' ',  " 자재 번호
                              ' ' 'STLNO'   'ZC102MMT0017' ' ' ' ',  " 창고 번호
                              ' ' 'PEQUAN'  'ZC102MMT0017' ' ' ' ',  " 수량
                              ' ' 'MEINS'   'ZC102MMT0017' 'C' 'X',  " 단위
                              ' ' 'STPRS'   'ZC102MMT0017' ' ' ' ',  " 단가
                              ' ' 'WAERS'   'ZC102MMT0017' 'C' 'X',  " 통화키
                              ' ' 'PARTNER' 'ZC102MMT0017' 'C' ' ',  " 비즈니스파트너 번호
                              ' ' 'DEPNO_NAME'   ' '       'C' ' '.  " 구매요청부서 번호

    PERFORM set_layout_top.

    PERFORM create_object.

    SET HANDLER : lcl_event_handler=&gt;edit_toolbar_top FOR go_tab_grid2 ,
                  lcl_event_handler=&gt;user_command     FOR go_tab_grid2,
                  lcl_event_handler=&gt;edit_toolbar_bottom FOR go_tab_grid4,
                  lcl_event_handler=&gt;user_command        FOR go_tab_grid4.

<font color ="#0000FF">*-- Display TOP ALV</font>
    CALL METHOD go_tab_grid1-&gt;set_table_for_first_display
      EXPORTING
        is_variant      = gs_variant
        i_save          = 'A'
        i_default       = 'X'
        is_layout       = gs_layout_top
      CHANGING
        it_outtab       = gt_pr
        it_fieldcatalog = gt_tab_fcat1.

    CALL METHOD go_tab_grid2-&gt;set_table_for_first_display
      EXPORTING
        is_variant      = gs_variant
        i_save          = 'A'
        i_default       = 'X'
        is_layout       = gs_layout_top
      CHANGING
        it_outtab       = gt_tab2
        it_fieldcatalog = gt_tab_fcat2.

    CALL METHOD go_tab_grid3-&gt;set_table_for_first_display
      EXPORTING
        is_variant      = gs_variant
        i_save          = 'A'
        i_default       = 'X'
        is_layout       = gs_layout_top
      CHANGING
        it_outtab       = gt_tab3
        it_fieldcatalog = gt_tab_fcat3.

    CALL METHOD go_tab_grid4-&gt;set_table_for_first_display
      EXPORTING
        is_variant      = gs_variant
        i_save          = 'A'
        i_default       = 'X'
        is_layout       = gs_layout_top
      CHANGING
        it_outtab       = gt_tab4
        it_fieldcatalog = gt_tab_fcat4.

    PERFORM refresh_alv_grid.

  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_fcat_top</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_fcat1  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_tab_fcat1-key       = pv_key.
  gs_tab_fcat1-fieldname = pv_field.
  gs_tab_fcat1-ref_table = pv_table.
  gs_tab_fcat1-just      = pv_just.
  gs_tab_fcat1-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'PEQUAN'.
      gs_tab_fcat1-qfieldname = 'MEINS'.
    WHEN 'STPRS'.
      gs_tab_fcat1-cfieldname = 'WAERS'.
    WHEN 'STATUS'.
      gs_tab_fcat1-coltext = '상태'.
    WHEN 'MEINS'.
      gs_tab_fcat1-coltext = '단위'.
    WHEN 'WAERS'.
      gs_tab_fcat1-coltext = '통화키'.
    WHEN 'DEPNO_NAME'.
      gs_tab_fcat1-coltext = '구매요청 부서'.
  ENDCASE.

  APPEND gs_tab_fcat1 TO gt_tab_fcat1.
  CLEAR gs_tab_fcat1.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_layout_top</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_layout_top .

  gs_layout_top-zebra      = abap_true.    " 행 줄무늬 지정
  gs_layout_top-cwidth_opt = 'A'.          " 컬럼 폭 자동 조정
  gs_layout_top-sel_mode   = 'A'.          " 행 단일 선택
  gs_layout_top-grid_title = '구매요청 내역'.  " 제목 지정

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_object</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_object .

  CREATE OBJECT go_tab_cont1
    EXPORTING
      container_name = 'TAB1'.

  CREATE OBJECT go_tab_cont2
    EXPORTING
      container_name = 'TAB2'.

  CREATE OBJECT go_tab_cont3
    EXPORTING
      container_name = 'TAB3'.

  CREATE OBJECT go_tab_cont4
    EXPORTING
      container_name = 'TAB4'.

  CREATE OBJECT go_tab_grid1
    EXPORTING
      i_parent = go_tab_cont1.

  CREATE OBJECT go_tab_grid2
    EXPORTING
      i_parent = go_tab_cont2.

  CREATE OBJECT go_tab_grid3
    EXPORTING
      i_parent = go_tab_cont3.

  CREATE OBJECT go_tab_grid4
    EXPORTING
      i_parent = go_tab_cont4.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form refresh_alv_grid</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM refresh_alv_grid .

  DATA : ls_stable TYPE lvc_s_stbl.

<font color ="#0000FF">*-- 위치하고 있던 컬럼, 행 고정</font>
  ls_stable-col = abap_true.
  ls_stable-row = abap_true.

  CASE gc_tab-activetab.
    WHEN 'TAB1'.
      CALL METHOD go_tab_grid1-&gt;refresh_table_display
        EXPORTING
          is_stable = ls_stable.
    WHEN 'TAB2'.
      CALL METHOD go_tab_grid2-&gt;refresh_table_display
        EXPORTING
          is_stable = ls_stable.
    WHEN 'TAB3'.
      CALL METHOD go_tab_grid3-&gt;refresh_table_display
        EXPORTING
          is_stable = ls_stable.
    WHEN 'TAB4'.
      CALL METHOD go_tab_grid4-&gt;refresh_table_display
        EXPORTING
          is_stable = ls_stable.
  ENDCASE.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_pr_search</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_pr_search .

  gr_prno-sign = 'I'.
  gr_prno-option = 'EQ'.
  gr_prno-low = zc102mmt0017-prno.

  APPEND gr_prno.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_data_condition</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_data_condition .

  " 구매요청 range 초기화
  _init gr_prno.

  " 입력한 값을 range에 넣어주기
  IF zc102mmt0017-prno IS NOT INITIAL.
    PERFORM set_pr_search.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_pr_approve</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_pr_approve .

  DATA : lt_roid TYPE lvc_t_roid,
         ls_tab2 LIKE gs_tab2. " &lt;- 대기탭 행 구조

  go_tab_grid2-&gt;get_selected_rows( IMPORTING et_row_no = lt_roid ).

<font color ="#0000FF">*-- 선택된 행이 없을 시</font>
  IF lt_roid IS INITIAL.
    MESSAGE s009 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

<font color ="#0000FF">*-- 선택된 행 읽어오기 (gt_tab2 기준으로!)</font>
  READ TABLE lt_roid INTO DATA(ls_roid) INDEX 1.
  IF sy-subrc = 0.
    gv_rowid = ls_roid-row_id. " 선택된 대기탭의 인덱스
    READ TABLE gt_tab2 INTO ls_tab2 INDEX gv_rowid.

    IF sy-subrc &lt;&gt; 0.
      MESSAGE s004 DISPLAY LIKE 'E'.
      EXIT.
    ENDIF.

    " 상태 체크 (대기 상태여야 승인 가능)
    IF ls_tab2-state = '1'.
      MESSAGE s030 DISPLAY LIKE 'E'.
      EXIT.
    ELSEIF ls_tab2-state = '2'.
      MESSAGE s037 DISPLAY LIKE 'E'.
      EXIT.
    ENDIF.

    " gs_pr에 옮겨 담기 (create_po에서 gs_pr 참조 중)
    gs_pr = CORRESPONDING #( ls_tab2 ).
  ENDIF.

<font color ="#0000FF">*-- 승인 팝업 호출</font>
  CALL SCREEN 110 STARTING AT 05 10.

<font color ="#0000FF">*-- 강제 PBO 실행</font>
  CALL METHOD cl_gui_cfw=&gt;set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

  PERFORM refresh_alv_grid.

ENDFORM.

<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_popup_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_popup_screen .

<font color ="#0000FF">*-- 입력 기본값 지정</font>
  zc102mmt0011-podat = sy-datum. " 당일날짜

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form show_approval_popup</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM show_approval_popup .

  DATA : lv_answer, lv_flag.

<font color ="#0000FF">*-- 입력값 유효성 체크</font>
  PERFORM check_inputs CHANGING lv_flag.

  IF lv_flag IS NOT INITIAL.
    MESSAGE s063 DISPLAY LIKE 'E'.       " 필수 항목이 입력되지 않았습니다.
    EXIT.
  ENDIF.

<font color ="#0000FF">*-- 유효성 체크 통과후, 확인 팝업</font>
  CALL FUNCTION 'POPUP_TO_CONFIRM'
    EXPORTING
      titlebar              = '구매오더 생성'
      text_question         = '승인하시겠습니까?'
      text_button_1         = '네'
      icon_button_1         = 'ICON_OKAY'
      text_button_2         = '아니오'
      icon_button_2         = 'ICON_CANCEL'
      default_button        = '2'
      display_cancel_button = ' '
    IMPORTING
      answer                = lv_answer.

<font color ="#0000FF">*-- 최종 승인 및 구매오더 생성</font>
  CHECK lv_answer EQ '1'.

  PERFORM create_po.

  CLEAR : zc102hrt0002-empnam, zc102hrt0002-empno.

  LEAVE TO SCREEN 0.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_po</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_po .

  DATA : lv_index TYPE i,
         lv_ebeln TYPE zc102mmt0011-ebeln.

<font color ="#0000FF">*-- 구매오더번호 채번</font>
  PERFORM create_ebeln CHANGING lv_ebeln.

<font color ="#0000FF">*-- 구매요청 -&gt; 구매오더 필드 매핑</font>
  PERFORM generate_po CHANGING lv_ebeln.

<font color ="#0000FF">*-- 구매요청내역 업데이트</font>
  IF sy-subrc = 0.
    PERFORM update_pr CHANGING lv_ebeln.
    COMMIT WORK.

<font color ="#0000FF">*-- 다시 조회</font>
    PERFORM set_data_condition.
    PERFORM set_data.
    PERFORM count_data.

<font color ="#0000FF">*-- ALV 새로고침</font>
    PERFORM refresh_alv_grid.

    MESSAGE s031 WITH '구매오더'.

  ELSE.
    MESSAGE s032 WITH '구매오더 생성' DISPLAY LIKE 'E'.

  ENDIF.

ENDFORM.

<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_ebeln</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_ebeln CHANGING pv_result TYPE zc102mmt0011-ebeln.

  DATA: gv_number    TYPE n LENGTH 10,
        gv_prefix(3),
        gv_full_code TYPE string,
        gv_range_nr  TYPE inri-nrrangenr,
        gv_quantity  TYPE inri-quantity.

  DATA: ls_nriv TYPE nriv.

  gv_prefix = 'PO'.   " prefix
  gv_range_nr = '01'. " 번호
  gv_quantity = 1.    " 증가량

<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* 순번 호출</font>
<font color ="#0000FF">**********************************************************************</font>
  CALL METHOD zclc102cm_auto_sequence=&gt;get_next_value
    EXPORTING
      pv_range_nr = gv_range_nr
      pv_prefix   = gv_prefix
      pv_quantity = gv_quantity
    IMPORTING
      pv_result   = gv_full_code.

  pv_result = CONV zc102mmt0011-ebeln( gv_full_code ). " String -&gt; char

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_status</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_status .

  DATA: lv_tabix TYPE sy-tabix.

  CLEAR: gv_allpr_cnt, gv_apprv_cnt, gv_rtrn_cnt, gv_rdy_cnt.

  LOOP AT gt_pr INTO DATA(ls_pr).
    lv_tabix = sy-tabix.

    CASE ls_pr-state.
      WHEN '1'.
        ls_pr-status = icon_led_green.
      WHEN '2'.
        ls_pr-status = icon_led_red.
      WHEN '3'.
        ls_pr-status = icon_led_yellow.
    ENDCASE.

    MODIFY gt_pr FROM ls_pr INDEX lv_tabix TRANSPORTING status.

  ENDLOOP.

<font color ="#0000FF">*-- 상태별 재분류 (gt_tab2, gt_tab3 재구성)</font>
  CLEAR: gt_tab2, gt_tab3, gt_tab4.

  LOOP AT gt_pr INTO ls_pr.
    CASE ls_pr-state.
      WHEN '1'.
        gs_tab4 = CORRESPONDING #( ls_pr ).
        APPEND gs_tab4 TO gt_tab4.
      WHEN '2'.
        gs_tab3 = CORRESPONDING #( ls_pr ).
        APPEND gs_tab3 TO gt_tab3.
      WHEN '3'.
        gs_tab2 = CORRESPONDING #( ls_pr ).
        APPEND gs_tab2 TO gt_tab2.
    ENDCASE.
  ENDLOOP.

  PERFORM count_data.

ENDFORM.

<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form check_inputs</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM check_inputs CHANGING pv_flag.

  IF zc102mmt0011-podat IS INITIAL OR   " 구매승인 일자
     zc102hrt0002-empno IS INITIAL OR   " 사원번호
     zc102hrt0002-empnam  IS INITIAL.     " 담당사원
    pv_flag = 'X'.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form generate_po</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM generate_po CHANGING pv_ebeln TYPE zc102mmt0011-ebeln.

  DATA: ls_save_po TYPE zc102mmt0011,
        lv_rgtime  TYPE zc102mmt0004-rgtime,
        lv_gredat  TYPE sy-datum.

<font color ="#0000FF">*-- 입고리드타임 조회</font>
  SELECT SINGLE rgtime
    INTO lv_rgtime
    FROM zc102mmt0004
    WHERE matnr = gs_pr-matnr.

<font color ="#0000FF">*-- 입고예정일 계산: 구매오더일자 + 배송리드타임.</font>
  lv_gredat = zc102mmt0011-podat + lv_rgtime.

  CLEAR gs_po.
  gs_po-ebeln   = pv_ebeln.                   " 생성된 구매오더 번호
  gs_po-prno    = gs_pr-prno.                 " 구매요청 번호
  gs_po-podat   = zc102mmt0011-podat.         " 구매오더 일자
  gs_po-partner = gs_pr-partner.              " 거래처 번호
  gs_po-matnr   = gs_pr-matnr.                " 자재 번호
  gs_po-stprs   = gs_pr-stprs.                " 단가
  gs_po-waers   = gs_pr-waers.                " 통화키
  gs_po-menge   = gs_pr-pequan.               " 수량
  gs_po-meins   = gs_pr-meins.                " 단위
  gs_po-stlno   = gs_pr-stlno.                " 창고 번호
  gs_po-empno   = zc102hrt0002-empno.         " 사원번호
  gs_po-dzeit   = lv_rgtime.
  gs_po-gredat  = lv_gredat.                  " 입고예정일자

  IF gs_po-stlno IS INITIAL OR
      gs_po-prno IS INITIAL OR
      gs_po-ebeln IS INITIAL.
    MESSAGE s066 DISPLAY LIKE 'E'.
    sy-subrc = 4.
    RETURN.
  ENDIF.

  APPEND gs_po TO gt_po.

<font color ="#0000FF">*-- 저장용 테이블에 담기</font>
  ls_save_po = CORRESPONDING #( gs_po ).

<font color ="#0000FF">*-- 타임스탬프 추가</font>
  ls_save_po-erdat = sy-datum.
  ls_save_po-ernam = zc102hrt0002-empnam.
  ls_save_po-erzet = sy-uzeit.

<font color ="#0000FF">*-- 저장 전 PK 체크</font>
  IF ls_save_po-ebeln IS INITIAL OR
     ls_save_po-prno IS INITIAL OR
     ls_save_po-stlno IS INITIAL.

    MESSAGE s032 WITH '구매오더 생성'.
    sy-subrc = 4.
    RETURN.
  ENDIF.

<font color ="#0000FF">*-- 구매오더 DB 테이블에 반영</font>
  MODIFY zc102mmt0011 FROM ls_save_po.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form update_pr</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM update_pr CHANGING pv_ebeln TYPE zc102mmt0011-ebeln.

  DATA ls_save_pr TYPE zc102mmt0017.
  DATA ls_old_pr  TYPE zc102mmt0017.

<font color ="#0000FF">*-- 구매 승인 여부 갱신</font>
  gs_pr-state  = '1'.
  gs_pr-status = icon_led_green.
  gs_pr-ebeln  = pv_ebeln.

<font color ="#0000FF">*-- 내부 테이블 업데이트 (화면용)</font>
  MODIFY gt_pr FROM gs_pr INDEX gv_rowid TRANSPORTING state status ebeln.

<font color ="#0000FF">*-- 대기탭에서 제거</font>
  DELETE gt_tab2 WHERE prno = gs_pr-prno AND matnr = gs_pr-matnr.

<font color ="#0000FF">*-- 기존 생성 정보 가져오기 (erdat, ernam, erzet 유지용)</font>
  SELECT SINGLE erdat ernam erzet
    INTO (ls_old_pr-erdat, ls_old_pr-ernam, ls_old_pr-erzet)
    FROM zc102mmt0017
    WHERE prno = gs_pr-prno AND matnr = gs_pr-matnr.

<font color ="#0000FF">*-- 변경값 복사</font>
  ls_save_pr = CORRESPONDING #( gs_pr ).

<font color ="#0000FF">*-- 생성자 정보 유지</font>
  ls_save_pr-erdat = ls_old_pr-erdat.
  ls_save_pr-ernam = ls_old_pr-ernam.
  ls_save_pr-erzet = ls_old_pr-erzet.

<font color ="#0000FF">*-- 변경자 정보 입력</font>
  ls_save_pr-aedat = sy-datum.
  ls_save_pr-aenam = sy-uname.
  ls_save_pr-aezet = sy-uzeit.

<font color ="#0000FF">*-- DB 반영</font>
  MODIFY zc102mmt0017 FROM ls_save_pr.

ENDFORM.

<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form confirm_popup</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form handle_edit_toolbar</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_OBJECT</font>
<font color ="#0000FF">*&      --&gt; E_INTERACTIVE</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM handle_edit_toolbar_bottom USING po_object TYPE REF TO cl_alv_event_toolbar_set
                               pv_interactive.

  CLEAR gs_button.
  gs_button-butn_type = '3'.
  APPEND gs_button TO po_object-&gt;mt_toolbar.

  CLEAR gs_button.
  gs_button-function  = 'RTRN'.
  gs_button-icon      = icon_incomplete.
  gs_button-text      = '반려'.
  gs_button-quickinfo = '구매오더 반려 처리'.
  APPEND gs_button TO po_object-&gt;mt_toolbar.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form handle_user_command</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_UCOMM</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM handle_user_command USING pv_ucomm.

  CASE pv_ucomm.
    WHEN 'RTRN'.
      PERFORM return_to_pr.
    WHEN 'GOPO'.                 " 구매요청 승인
      PERFORM set_pr_approve.

  ENDCASE.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form return_to_pr</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM return_to_pr.

  DATA : lt_roid   TYPE lvc_t_roid,
         lv_answer TYPE c,
         ls_roid   TYPE lvc_s_roid,
         lv_prno   TYPE zc102mmt0011-prno,
         lv_matnr  TYPE zc102mmt0011-matnr.

<font color ="#0000FF">*-- 행 선택</font>
  go_tab_grid4-&gt;get_selected_rows( IMPORTING et_row_no = lt_roid ).

  IF lt_roid IS INITIAL.
    MESSAGE s009 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

<font color ="#0000FF">*-- 선택된 행에서 prno, matnr 추출</font>
  READ TABLE lt_roid INTO ls_roid INDEX 1.
  READ TABLE gt_tab4 INTO gs_tab4 INDEX ls_roid-row_id.
  IF sy-subrc &lt;&gt; 0.
    MESSAGE s004 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  lv_prno  = gs_tab4-prno.
  lv_matnr = gs_tab4-matnr.

<font color ="#0000FF">*-- 반려 확인 팝업</font>
  PERFORM confirm_return_popup USING lv_prno lv_matnr CHANGING lv_answer.

  CHECK lv_answer EQ '1'.

<font color ="#0000FF">*-- 반려 처리</font>
  PERFORM delete_po USING lv_prno lv_matnr.

<font color ="#0000FF">*-- ALV 새로고침</font>
  PERFORM refresh_alv_grid.

  MESSAGE s001 WITH '구매오더가 반려되었습니다.' DISPLAY LIKE 'S'.

  CALL METHOD cl_gui_cfw=&gt;set_new_ok_code
    EXPORTING
      new_code = 'XXXX'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form confirm_return_popup</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      &lt;-- PV_ANSWER</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM confirm_return_popup USING pv_prno TYPE zc102mmt0011-prno
                                 pv_matnr TYPE zc102mmt0011-matnr
                          CHANGING pv_answer TYPE c.

<font color ="#0000FF">*-- 구매오더 찾기</font>
  READ TABLE gt_po INTO gs_po WITH KEY prno = pv_prno matnr = pv_matnr.
  IF sy-subrc NE 0.
    MESSAGE s004 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

<font color ="#0000FF">*-- 대응되는 구매요청 찾기</font>
  READ TABLE gt_pr INTO gs_pr WITH KEY prno = pv_prno matnr = pv_matnr.
  IF sy-subrc NE 0.
    MESSAGE s004 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

<font color ="#0000FF">*-- 승인된 상태인지 확인</font>
  IF gs_pr-state NE '1'.
    MESSAGE s030 DISPLAY LIKE 'E'. " 승인 상태 아님
    EXIT.
  ENDIF.

<font color ="#0000FF">*-- 팝업 표시</font>
  CALL FUNCTION 'POPUP_TO_CONFIRM'
    EXPORTING
      titlebar              = '구매오더 반려'
      text_question         = '해당 구매오더를 반려하시겠습니까?'
      text_button_1         = '예'
      icon_button_1         = 'ICON_OKAY'
      text_button_2         = '아니오'
      icon_button_2         = 'ICON_CANCEL'
      default_button        = '2'
      display_cancel_button = ' '
    IMPORTING
      answer                = pv_answer.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form delete_po</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM delete_po USING pv_prno   TYPE zc102mmt0011-prno
                      pv_matnr TYPE zc102mmt0011-matnr.

  DATA : ls_save_po TYPE zc102mmt0011,
         ls_save_pr TYPE zc102mmt0017.

<font color ="#0000FF">*-- ALV용 내부 테이블 삭제</font>
  DELETE gt_po WHERE prno = pv_prno AND matnr = pv_matnr.

<font color ="#0000FF">*-- 구매요청 상태 변경 (반려)</font>
  READ TABLE gt_pr INTO gs_pr WITH KEY prno = pv_prno matnr = pv_matnr.
  IF sy-subrc = 0.
    gs_pr-state  = '2'.
    gs_pr-status = icon_led_red.
    MODIFY gt_pr FROM gs_pr TRANSPORTING state status
      WHERE prno = pv_prno AND matnr = pv_matnr.
  ENDIF.

<font color ="#0000FF">*-- 상태 아이콘 다시 설정</font>
  PERFORM set_status.

<font color ="#0000FF">*-- DB 반영 (구매요청 상태 변경)</font>
  UPDATE zc102mmt0017
     SET state = '2'
   WHERE prno = pv_prno
     AND matnr = pv_matnr.

<font color ="#0000FF">*-- DB 반영 (구매오더 삭제)</font>
  DELETE FROM zc102mmt0011 WHERE prno = pv_prno AND matnr = pv_matnr.

  COMMIT WORK.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form handle_edit_toolbar_bottom</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_OBJECT</font>
<font color ="#0000FF">*&      --&gt; E_INTERACTIVE</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM handle_edit_toolbar_top  USING po_object TYPE REF TO cl_alv_event_toolbar_set
                                       pv_interactive.

  CLEAR gs_button.
  gs_button-butn_type = '3'.
  APPEND gs_button TO po_object-&gt;mt_toolbar.

  CLEAR gs_button.
  gs_button-function  = 'GOPO'.
  gs_button-icon      = icon_checked.
  gs_button-text      = '승인'.
  gs_button-quickinfo = '구매오더 생성'.
  APPEND gs_button TO po_object-&gt;mt_toolbar.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form handle_user_command_bottom</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_UCOMM</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM handle_user_command_top  USING pv_ucomm.



ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_f4_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM get_f4_data .

  CLEAR gt_empnam.
  SELECT empno empnam
    INTO CORRESPONDING FIELDS OF TABLE gt_empnam
    FROM zc102hrt0002
    ORDER BY empno.

  CLEAR gt_prno.
  SELECT prno
    INTO CORRESPONDING FIELDS OF TABLE gt_prno
    FROM zc102mmt0017
    ORDER BY prno.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_search_help_empnam</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_search_help_empnam .

  DATA: lt_return TYPE TABLE OF ddshretval,
        ls_return TYPE ddshretval,
        ls_empnam LIKE gs_empnam.

  " F4 도움말 팝업 표시
  CALL FUNCTION 'F4IF_INT_TABLE_VALUE_REQUEST'
    EXPORTING
      retfield     = 'EMPNAM'
      dynpprog     = sy-cprog
      dynpnr       = sy-dynnr
      dynprofield  = 'GT_EMPNAM-ENPNAM'
      window_title = '사원명'
      value_org    = 'S'
    TABLES
      value_tab    = gt_empnam
      return_tab   = lt_return.

  " 선택한 사원번호로 내부 테이블에서 사원명 조회
  READ TABLE lt_return INTO ls_return INDEX 1.
  IF sy-subrc = 0 AND ls_return-fieldval IS NOT INITIAL.

    zc102hrt0002-empnam = ls_return-fieldval.

    READ TABLE gt_empnam INTO ls_empnam WITH KEY empnam = zc102hrt0002-empnam.
    IF sy-subrc = 0.
      zc102hrt0002-empno = ls_empnam-empno.
    ELSE.
      CLEAR zc102hrt0002-empno.
    ENDIF.

  ENDIF.

  CALL METHOD cl_gui_cfw=&gt;set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_tabscreen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_tabscreen .

  CASE gc_tab-activetab.
    WHEN 'TAB1'.
      gv_subscreen = '0101'.
    WHEN 'TAB2'.
      gv_subscreen = '0102'.
    WHEN 'TAB3'.
      gv_subscreen = '0103'.
    WHEN 'TAB4'.
      gv_subscreen = '0104'.
    WHEN OTHERS.
      gc_tab-activetab = 'TAB1'.
      gv_subscreen = '0101'.
  ENDCASE.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_fcat2</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_fcat2  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_tab_fcat2-key       = pv_key.
  gs_tab_fcat2-fieldname = pv_field.
  gs_tab_fcat2-ref_table = pv_table.
  gs_tab_fcat2-just      = pv_just.
  gs_tab_fcat2-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'PEQUAN'.
      gs_tab_fcat2-qfieldname = 'MEINS'.
    WHEN 'STPRS'.
      gs_tab_fcat2-cfieldname = 'WAERS'.
    WHEN 'STATUS'.
      gs_tab_fcat2-coltext = '상태'.
    WHEN 'MEINS'.
      gs_tab_fcat2-coltext = '단위'.
    WHEN 'WAERS'.
      gs_tab_fcat2-coltext = '통화키'.
    WHEN 'DEPNO_NAME'.
      gs_tab_fcat2-coltext = '구매요청 부서'.
  ENDCASE.

  APPEND gs_tab_fcat2 TO gt_tab_fcat2.
  CLEAR gs_tab_fcat2.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_fcat3</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_fcat3  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_tab_fcat3-key       = pv_key.
  gs_tab_fcat3-fieldname = pv_field.
  gs_tab_fcat3-ref_table = pv_table.
  gs_tab_fcat3-just      = pv_just.
  gs_tab_fcat3-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'PEQUAN'.
      gs_tab_fcat3-qfieldname = 'MEINS'.
    WHEN 'STPRS'.
      gs_tab_fcat3-cfieldname = 'WAERS'.
    WHEN 'STATUS'.
      gs_tab_fcat3-coltext = '상태'.
    WHEN 'MEINS'.
      gs_tab_fcat3-coltext = '단위'.
    WHEN 'WAERS'.
      gs_tab_fcat3-coltext = '통화키'.
    WHEN 'DEPNO_NAME'.
      gs_tab_fcat3-coltext = '구매요청 부서'.
  ENDCASE.

  APPEND gs_tab_fcat3 TO gt_tab_fcat3.
  CLEAR gs_tab_fcat3.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form count_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM count_data .

  gv_allpr_cnt = lines( gt_pr ).
  gv_apprv_cnt = lines( gt_tab4 ).
  gv_rdy_cnt = lines( gt_tab2 ).
  gv_rtrn_cnt = lines( gt_tab3 ).

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_empno</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_empno .

  DATA : ls_empnam LIKE LINE OF gt_empnam.

  READ TABLE gt_empnam INTO ls_empnam WITH KEY empnam = zc102hrt0002-empnam.
  IF sy-subrc = 0.
    zc102hrt0002-empno = ls_empnam-empno.
  ELSE.
    CLEAR zc102hrt0002-empno.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_search_help_prno</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_search_help_prno .

  DATA : lt_return LIKE ddshretval OCCURS 0 WITH HEADER LINE,
         ls_modi   TYPE lvc_s_modi.

  DATA : BEGIN OF dynpfields OCCURS 0.
           INCLUDE TYPE dynpread.
  DATA : END OF dynpfields.

  CALL FUNCTION 'F4IF_INT_TABLE_VALUE_REQUEST'
    EXPORTING
      retfield     = 'PRNO'
      dynpprog     = sy-cprog
      dynpnr       = sy-dynnr
      dynprofield  = 'GT_PRNO-PRNO'
      window_title = '구매요청 번호'
      value_org    = 'S'
    TABLES
      value_tab    = gt_prno
      return_tab   = lt_return.

  READ TABLE dynpfields WITH KEY fieldname = lt_return-retfield.
  IF sy-subrc = 0.
    dynpfields-fieldvalue = lt_return-fieldval.
    MODIFY dynpfields INDEX sy-tabix.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_search_help_prno</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_fcat4</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_fcat4  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_tab_fcat4-key       = pv_key.
  gs_tab_fcat4-fieldname = pv_field.
  gs_tab_fcat4-ref_table = pv_table.
  gs_tab_fcat4-just      = pv_just.
  gs_tab_fcat4-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'PEQUAN'.
      gs_tab_fcat4-qfieldname = 'MEINS'.
    WHEN 'STPRS'.
      gs_tab_fcat4-cfieldname = 'WAERS'.
    WHEN 'STATUS'.
      gs_tab_fcat4-coltext = '상태'.
    WHEN 'MEINS'.
      gs_tab_fcat4-coltext = '단위'.
    WHEN 'WAERS'.
      gs_tab_fcat4-coltext = '통화키'.
    WHEN 'DEPNO_NAME'.
      gs_tab_fcat4-coltext = '구매요청 부서'.
  ENDCASE.

  APPEND gs_tab_fcat4 TO gt_tab_fcat4.
  CLEAR gs_tab_fcat4.

ENDFORM.
</pre>
<hr>
<font size="2" face = "Sans Serif">Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 758
</font>
</body>
</html>
